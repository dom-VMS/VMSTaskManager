<% if logged_in? %>
<div class="container-fluid">
  <h1>Welcome,</h1>
  <h1><strong><%= current_user.full_name %></strong></h1>
  <h5><%=Time.now.strftime("%m/%d/%Y") %></h5>

</div>
<div class="container-fluid">
    <br><h2>Your Queue:</h2>
    <div class="card-columns">
        <div class="card">
            <div class="card-header">
                <a data-toggle="collapse" href="#collapse-task-queue" aria-expanded="true" aria-controls="collapse-task-queue" id="heading-task-queue" class="d-block">
                    <i class="fa fa-chevron-down pull-right"></i>
                    <strong><%= current_user.full_name %>'s Queue</strong>
                </a>
            </div>
            <div id="collapse-task-queue" class="collapse show" aria-labelledby="heading-task-queue">
                <div class="card-body-custom">
                    <div class="list-group list-group-flush">
                        <div id="task_queues" class="list-group list-group-flush" data-url="<%= home_index_path %>">
                        <% @task_queue.each do |queue| %>
                            <%= link_to queue.title, queue, class: "list-group-item", id: dom_id(queue) %>
                        <% end %>
                        </div>
                    </div> 
                </div>
            </div>
        </div>
    </div>  
</div>
<div class="container-fluid">
  <br><h2>A2ssigned to you:</h2>
    <div class="card-columns">
        <% @task_types.each do |task_type| %>
        <div class="card">
            <div class="card-header">
                <a data-toggle="collapse" href="#collapse-assigned-to-you-<%=task_type.id %>" aria-expanded="true" aria-controls="collapse-assigned-to-you-<%=task_type.id %>" id="heading-assigned-to-you-<%=task_type.id %>" class="d-block">
                    <i class="fa fa-chevron-down pull-right"></i>
                    <strong><%= task_type.name %></strong>
                </a>
            </div>
            <div id="collapse-assigned-to-you-<%=task_type.id %>" class="collapse show" aria-labelledby="heading-assigned-to-you-<%=task_type.id %>">
                <div class="card-body-custom">
                    <% (@task.where(task_type_id: task_type.id)).each do |task|%>
                    <div class="list-group list-group-flush">
                        <div class="list-group-item py-2 d-flex justify-content-between align-items-center list-group-item-linkable" data-link="<%= task_path(task)%>">
                            <%= task.title.empty? ? (link_to task.description.truncate_words(5), task_path(task)) : (link_to task.title.truncate_words(5), task_path(task)) %>
                            <%= task_priority(task) %>
                        </div>
                    </div> 
                    <%end%>
                </div>
            </div>
        </div>
        <%end%>
    </div>
</div><br>
<% else %>
  <%= render 'errors/not_signed_in' %>
<% end %>

<script>
  $(document).ready(function() {
    $('.list-group-item-linkable').on('click', function() {
        window.location.href = $(this).data('link');
    });

    $('.list-group-item-linkable a, .list-group-item-linkable button')
    .on('click', function(e) {
        e.stopPropagation();
    });
  });

  document.ready(function() {
    $("#task_queues").sortable({
        update: function(e, ui) {
        Rails.ajax({
            url: $(this).data("url"),
            type: "PATCH",
            data: $(this).sortable('serialize'),
        });
        }
    });
  });
</script>

