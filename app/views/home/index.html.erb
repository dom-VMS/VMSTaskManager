<% if logged_in? %>
<div class="container-fluid">
  <h1>Welcome,</h1>
  <h1><strong><%= current_user.full_name %></strong></h1>
  <h5><%=Time.now.strftime("%m/%d/%Y") %></h5>
  <h2>Assigned to you:</h2>
</div>
<div class="container-fluid">
    <div class="card-columns">
        <% @task_types.each do |task_type| %>
        <div class="card">
            <div class="card-header">
                <a data-toggle="collapse" href="#collapse-assigned-to-you-<%=task_type.id %>" aria-expanded="true" aria-controls="collapse-assigned-to-you-<%=task_type.id %>" id="heading-assigned-to-you-<%=task_type.id %>" class="d-block">
                    <i class="fa fa-chevron-down pull-right"></i>
                    <strong><%= task_type.name %></strong>
                </a>
            </div>
            <div id="collapse-assigned-to-you-<%=task_type.id %>" class="collapse show" aria-labelledby="heading-assigned-to-you-<%=task_type.id %>">
                <div class="card-body">
                    <table class="table table-borderless table-hover table-sm">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Priority</th>
                            </tr>
                        </thead>
                        <% (@task.where(task_type_id: task_type.id)).each do |task|%>
                        <tbody> 
                            <tr data-link="<%= task_path(task)%>">
                                <td><%= task.title.empty? ? (link_to task.description.truncate_words(5), task_path(task)) :  (link_to task.title.truncate_words(5), task_path(task)) %></td>
                                <td><%= task.priority.nil? ? "" : task_priority(task) %></td>
                            </tr>
                        </tbody> 
                        <%end%>
                    </table>
                </div>
            </div>
        </div>
        <%end%>
    </div>
</div>
<% else %>
  <%= render 'errors/not_signed_in' %>
<% end %>

<script>
    $("tr[data-link]").click(function() {
    window.location = $(this).data("link")
  })
</script>

