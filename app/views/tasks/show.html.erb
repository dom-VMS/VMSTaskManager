<div class="container-fluid">
    <div class="row content">
        <div class="col-sm-1 bg-light"></div>
        <div class="col-sm-10">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/home/index">Home</a></li>
                    <li class="breadcrumb-item"><a href="/task_types">Departments</a></li>
                    <li class="breadcrumb-item"><a href="/task_types/<%=@task.task_type_id%>"><%=TaskType.find(@task.task_type_id).name unless @task.task_type_id.blank?%></a></li>
                    <li class="breadcrumb-item active" aria-current="page">Task #<%=@task.id%></li>
                </ol>
            </nav>
            <h1>
                VMS Task #<%= @task.id %>
                <% if @task.isApproved.nil? %>
                    <span class="badge badge-warning">Awaiting Approval</span>
                    <% unless @task_type_option.nil?%>
                        <p>
                            <%= (link_to fa_icon('check-circle', text:'Approve Ticket'), review_path(@task, :isApproved => true, :id => @task.id), class: "btn btn-primary",
                                        method: 'put', 
                                        data: { confirm: 'Are you sure you want to confirm this ticket?' }) if @task_type_option.can_approve %>
                            <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#declineTicketModal">
                                <%= fa_icon('times-circle', text:'Decline Ticket')%>
                            </button>  
                            <!-- Decline Ticket Modal -->
                            <div class="modal fade" id="declineTicketModal" tabindex="-1" role="dialog" aria-labelledby="declineTicketModalLabel" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="declineTicketModalLabel">Decline Ticket</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        ...
                                    </div>
                                    <div class="modal-footer">
                                        <%= (link_to fa_icon('times-circle', text:'Decline Task'), review_path(@task, :isApproved => false, :id => @task.id), class: "btn btn-danger ",
                                                                        method: 'put')%> 
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                    </div>
                                    </div>
                                </div>   
                            </div> 
                        </p>
                    <% end %>
                <% elsif @task.isApproved == false %>
                    <span class="badge badge-danger">Ticket Denied</span>
                <% elsif @task.isVerified == true %>
                    <span class="badge badge-success">Task Complete</span>
                <% elsif @task.isVerified == false %>
                    <span class="badge badge-warning">Rework Required</span>
                <% elsif @task.status == 3 && @task.isVerified != true %>
                    <span class="badge badge-secondary">Awaiting Verification</span>
                    <% unless @task_type_option.nil?%>
                        <p>
                            <%= (link_to fa_icon('check-circle', text:'Verify Completion'), review_path(@task, :isVerified => true, :id => @task.id), class: "btn btn-primary",
                                                method: 'put', 
                                                data: { confirm: 'Are you sure you want to confirm this task as complete?' }) if @task_type_option.can_verify %>
                            <%= (link_to fa_icon('times-circle', text:'Reject Completion'), review_path(@task, :isVerified => false, :id => @task.id), class: "btn btn-danger",
                                            method: 'put', 
                                            data: { confirm: 'Are you sure you want to send this task back out for re-work?' }) if @task_type_option.can_verify %> 
                        </p>
                    <%end%>
                <% end %>
            </h1>
            <hr>
            <h2><%= @task.title %>  <%= @task.priority.nil? ? "" : task_priority(@task) %> </h2>
            <p><h5><small><%= fa_icon('clock')%> Created By: <%= task_created_by_name(@task)%>, <%= time_ago_in_words(@task.created_at) %> ago</small></h5></p>

            <p><strong>Task Type:</strong> <%= TaskType.find(@task.task_type_id).name unless @task.task_type_id.blank?%></p>
            <p><strong>Assignee:</strong> <%= @assignee.blank? ? "All" : @assignee.full_name  %><br></p>   
            <p><strong>Description:</strong> <%= @task.description %></p> 

            <p><strong>Status:</strong> <%= @task.status.nil? ? "" : task_status(@task)%></p>
            <p>
                <strong>Percent Complete:</strong> 
                <div class="progress w-50">
                    <div style="width: <%= @task.percentComplete %>%;" 
                        aria-valuenow= "<%= @task.percentComplete %>" aria-valuemin="0" aria-valuemax="100">
                        <%= @task.percentComplete %>%
                    </div>
                </div>
            </p>
            <p><strong>Hours Spent: </strong><%= LoggedLabor.hours_spent_on_task(@task).zero?  ? '0' : LoggedLabor.hours_spent_on_task(@task) %></p>
            <p><strong>Attachments: </strong><%= render 'file_attachments/attachments' %></p>
            <% unless @task_type_option.nil?%>
            <%= link_to fa_icon('edit', text: "Edit"), edit_task_path(@task) if @task_type_option.can_update %><br>
            <%= (link_to fa_icon('trash-alt', text:'Delete'), task_path(@task),
                        method: :delete,
                        data: { confirm: 'Are you sure you want to delete this task?' }) if @task_type_option.can_delete %><br>
            <% end %>
            <br>
            <nav>
                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                    <a class="nav-item nav-link active" id="nav-comment-tab" data-toggle="tab" href="#nav-comment" role="tab" aria-controls="nav-comment" aria-selected="true">Comments</a>
                    <a class="nav-item nav-link" id="nav-time-spent-tab" data-toggle="tab" href="#nav-time-spent" role="tab" aria-controls="nav-time-spent" aria-selected="false">Time Spent</a>
                    <a class="nav-item nav-link" id="nav-edit-tab" data-toggle="tab" href="#nav-contact" role="tab" aria-controls="nav-contact" aria-selected="false">Activity</a>
                </div>
            </nav>
            <br>

            <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active"  id="nav-comment" role="tabpanel" aria-labelledby="nav-comment-tab">
                    <h2>Comments:</h2><br>
                    <div class="row">
                        <%= render @task.comments %>
                    </div>
                    <% unless @task_type_option.nil?%>
                        <% if @task_type_option.can_comment %>
                        <h4>Leave a Comment:</h4>
                        <%= render 'comments/form' %>
                        <br><br>
                        <% end %>
                    <% end %>
                </div>
                <div class="tab-pane fade" id="nav-time-spent" role="tabpanel" aria-labelledby="nav-time-spent-tab">
                    <%= render 'logged_labors/index'%>
                </div>
                <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">
                    <%= render 'activities/activity'%>
                </div>
            </div>  
        </div>
        <div class="col-sm-1 bg-light"></div>
    </div>
</div>
