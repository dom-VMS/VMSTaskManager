<div class="container-fluid text-center">
    <h1>Completed Tasks</h1>
    <p class="font-weight-light">Verify or Deny completion of tasks.</p>
</div>
<div class="container-fluid">
    <div class="row">
    <% @task.each do |task|%>
        <div class="col-sm-4">
        <%= link_to task_path(task) do %>
            <div class="card text-center mb-3">
                <div class="card-header"> 
                    <strong>Task #<%= task.id %></strong>  <%= task.priority.nil? ? "" : task_priority(task) %>
                </div>
                <div class="card-body">
                    <h5 class="card-title"><%= link_to task.title.truncate_words(5), task_path(task) %></h5>
                    <p class="card-text"><%= task.description.truncate_words(10) %></p> 
                    <%= (link_to fa_icon('check-circle'), review_path(task, :task => {:isVerified => true, :percentComplete => 100, :id => task.id}),
                                    class: "btn btn-primary btn-lg",
                                    method: 'put', 
                                    data: { confirm: 'By selecting this, you verify this task has been complete. Continue?' })%>
                    <button type="button" class="btn btn-danger btn-lg" data-toggle="modal" data-target="#declineTaskModal">
                        <%= fa_icon('times-circle')%>
                    </button>
                    <!-- Decline Task Modal -->
                    <div class="modal fade" id="declineTaskModal" tabindex="-1" role="dialog" aria-labelledby="declineTaskModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="declineTasKModalLabel">Decline Task</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <%= form_with(model: task, url: {action: "update_ticket"}) do |form| %>
                                <div class="modal-body">
                                    <h4>Why is this task is being declined?</h4>
                                    <p>
                                        <%= form.label :body, 'Click Decline Completion when finished.' %><br>
                                        <%= form.text_area :body, class: 'form-control', placeholder: "Please enter details here." %>
                                    </p>
                                    <%= form.fields_for :file_attachments_attributes do |fa| %>
                                        <p>
                                            <%= fa.label :file, 'Attach a File:' %>
                                            <%= fa.file_field :file %>
                                        </p>
                                    <% end %>
                                    <% commenter = current_user.full_name %>
                                    <%= form.hidden_field 'status', :value => 1 %>
                                    <%= form.hidden_field 'isVerified', :value => false %>
                                    <%= form.hidden_field 'id', :value => task.id %>
                                </div>   
                                <div class="modal-footer">
                                    <%= button_tag type: 'submit', class: "btn btn-lg btn-danger", id: "register-button" do %>
                                        <%= fa_icon('times-circle', text: 'Decline Completion')%>
                                    <% end %>
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                </div>
                                <% end %>
                            </div>
                        </div>   
                    </div>         
                </div>
                <div class="card-footer text-muted">
                    <%= time_ago_in_words(task.updated_at)%> ago
                </div>
            </div>
        <% end%>
        </div>
    <% end%>
    </div>
</div>